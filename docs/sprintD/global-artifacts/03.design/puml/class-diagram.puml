@startuml
skinparam packageStyle rectangle
skinparam shadowing false
skinparam linetype polyline
skinparam classAttributeIconSize 0

abstract class Person{
}

class Property{
      - area : double
      - distanceFromCenter : double
      - price : double
      - address : Address
      + getAddress() : Address
      + getArea() : double
      + getDistanceFromCenter() : int
      + getPrice() : double
      + toString() : String
}

class Announcement {
   - typeOfProperty : TypeOfProperty
   - transactionType : TransactionType
   - publishDate : Date
   - comission : Commission
   - photos ArrayList<Photo>
   - isPublished : boolean
   - id : int
   - idCounter : int
   + getProperty() : Property
   + toString() : String
}

class AnnouncementRepository {
    -announcements : ArrayList<Announcement>
    +getAllAnnouncementsSortedByDefualtCriteria() : ArrayList<Announcement>
    +getAllAnnouncementsSortedBySortCriteria(String sortCriteria, String order) : ArrayList<Announcement>
    +getFilteredAnnouncements(TypeOfProperty typeOfProperty, TransactionType transactionType, int numberOfRooms) : ArrayList<Announcement>
    +getFilteredAndSortedAnnouncements(TypeOfProperty typeOfProperty, TransactionType transactionType,\n int numberOfRooms, String sortCriteria, String order) : ArrayList<Announcement>
    +addAnnouncementFromImportedFile() : void
    +getAnnouncement(announcementID)
    +getAgentEmailFromAnnouncement(announcement)
    +getAllAnnouncementsSortedByDefaultCriteria()
}

class Repositories {
    -instance : Repositories
    -authenticationRepository : AuthenticationRepository
    -announcementRepository : AnnouncementRepository
    -employeeRepository : EmployeeRepository
    -agencyRepository : AgencyRepository
    -roleRepository : RoleRepository
    -orderRepository : OrderRepository
    +getAuthenticationRepository() : AuthenticationRepository
    +getAgencyListRepository() : AgencyRepository
    +getEmployeeRepository() : EmployeeRepository
    +getRoleRepository() : RoleRepository
    +getAnnouncementRepository() : AnnouncementRepository
    +getOrderRepository() : OrderRepository
    +Repositories()
    +getInstance() : Repositories
    +getAnnouncementRepository() : AnnouncementRepository
    +getVisitScheduleRepository()

}

class CreateOrderController {
    +someoneAlreadyMadeOrderWithSameAmountForThisAnnouncement(double orderAmount, int announcementId) : boolean
    +clientAlreadyMadeOrderForThisAnnouncement(int announcementId, String userEmail) : boolean
    +getPropertyPriceByAnnouncementId(int id) : double
    +getClientEmail() : String
    +getAllAnnouncements() : ArrayList<Announcement>
    +getPropertyByAnnouncement(Announcement announcement) : Property
    +createOrder(double orderAmount, int announcementId, String clientEmail, Date date, OrderState orderState) : void
}
class PropertyOrderManagementController {
    +getAllAnnouncementsSortedByproperty() : ArrayList<Announcement>
    +getOrdersListByAnnouncementId(Announcementid) : ArrayList<Order>
    +acceptOrder(Orderid,Announcementid) : void
    +rejectOrder(Orderid,Announcementid) : void
}

class CreateOrderUI {
    +showAnnouncements(ArrayList<Announcement> publishedPropertiesList) : void
    +createOrder(amount, id, clientEmail, date, orderState) : void
}

class ListAnnouncementsController {
     -announcementRepository : AnnouncementRepository
     +ListAnnouncementsController()
     +getAnnoucementRepository() : Repository
     +getAllAnnouncementsSortedByDefualtCriteria() : ArrayList<Announcement>
     +getAllAnnouncementsSortedBySortCriteria(String sortCriteria, String order) : ArrayList<Announcement>
     +getFilteredAnnouncements(ypeOfProperty typeOfProperty, TransactionType transactionType, int numberOfRooms) : ArrayList<Announcement>
     +getFilteredAndSortedAnnouncements(TypeOfProperty typeOfProperty, TransactionType transactionType,\n int numberOfRooms, String sortCriteria, String order) : ArrayList<Announcement>
}

class ListAnouncementsUI {
    - controller : ListAnnouncementsController
    +ListAnnouncementsUI()
    +checkInputType(typeOfProperty, transactionType, numberOfRooms, sortCriteria) : AnnouncementListOptionType
    +getAnnouncements(TypeOfProperty typeOfProperty, TransactionType transactionType,\n int numberOfRooms, String sortCriteria, String order) : ArrayList<Announcement>
    +getController() : ListAnnouncementsController


}

class Address{
    - street : String
    - city : String
    - district : String
    - state : String
    - zipCode : int
}

class CreateRequestController{
-agencyRepository : AgencyRepository
-employeeRepository : EmployeeRepository
-announcementRepository : AnnouncementRepository
-controller : CreateRequestController
-agencyList : Agency[]
+CreateRequestController() : CreateRequestController
+getAgentByEmail(String agentEmail) : Employee
+createAnnouncementHouse(Employee agent, TransactionType transactionType, int contractDuration, TypeOfProperty typeOfProperty,Property property) : void
+createAnnouncementLand(Employee agent, TransactionType transactionType, int contractDuration, TypeOfProperty typeOfProperty,Property property) : void
+createAnnouncementApartment(Employee agent, TransactionType transactionType, int contractDuration, TypeOfProperty typeOfProperty,Property property) : void
+AgencyOptions() : Agency[]
}

class PublishAnnouncementController{
-announcementRepository : AnnouncementRepository
-authenticationRepository : AuthenticationRepository
+PublishAnnouncementController() : PublishAnnouncementController
+getAnnouncementsByUser() : ArrayList<Announcement>
+publishAnnouncement(int id) : void
+setCommission(int id, Commission commission) : void
+getAnnouncementById(int id) : Announcement
}

class RegisterEmployeeController {
  -employeeRepository: EmployeeRepository
  -roleRepository: RoleRepository
  -passwordGenerator: PasswordGenerator
  -authenticationRepository: AuthenticationRepository
  +RegisterEmployeeController()
  +getRolesToCreate(): List<Role>
  +registerEmployee(name: String, email: String, passportCardNumber: int, taxNumber: int,telephoneNumber: int, address: Address, agency: Agency, roles: Set<Role>): boolean
}

class AuthenticationController{
-authenticationRepository : AuthenticationRepository
+AuthenticationController() : AuthenticationController
}

class UserSession{
+getUserId() : Email
+isLoggedIn(User user) : boolean
+hasSession(User user) : boolean
+isAdmin(User user) : boolean
}

class AuthenticationFacade{
    +getCurrentUserSession() : UserSession : UserSession
}

class Agency{
    - id: int
    - name: String
    - emailAddress: String
    - phoneNumber: int
    - address: Address
    - agents: ArrayList<Employee>
}

abstract class Residency extends Property{
-numberOfBedrooms : int
-numberOfBathrooms : int
-numberOfParkingSpaces : int
-hasCentralHeating : boolean
-hasAirConditioning : boolean
+Residency(double area, double distanceFromCenter, double price, Address address\n, int numberOfBedrooms, int numberOfBathrooms, int numberOfParkingSpaces, boolean hasCentralHeating, boolean hasAirConditioning)
+Residency(double area, double distanceFromCenter, double price, Address address\n, int numberOfBedrooms, int numberOfParkingSpaces)
+getNumberOfBedrooms() : int
+getNumberOfBathrooms() : int
+getNumberOfParkingSpaces() : int
+toString() : String
}

class Apartment extends Residency{
+toString() : String
}

class House extends Residency{
+toString() : String
}

class Land extends Property{
+toString() : String
}

class Commission{
-value : float
-percentage : double
-DEFAULT_VALUE : float
-DEFAULT_PERCENTAGE : double
+Commission(float value, int percentage)
+Commission(float value)
+Commission(double percentage)
+Commission()
+getValue() : float
+getPercentage() : double
+setValue(float value) : void
+setPercentage(double percentage) : void
+toString() : String
}

class Client extends Person{
}


class OrderRepository{
    +clientAlreadyMadeOrderForThisAnnouncement(String clientEmail, int announcementId) : boolean
    +someoneAlreadyMadeOrderWithSameAmountForThisAnnouncement(double orderAmount, int announcementId) : boolean
    +addOrder(double orderAmount, int announcementId, String clientEmail, Date date, OrderState orderState) : void
    +acceptOrder(Orderid,Announcementid)
    +rejectAllOrder(Announcementid)
    +rejectOrder(Orderid,Announcementid)
}

class Order{
    -id : int
    -idCounter : int
    -orderAmount : double
    -announcementId : int
    -clientEmail : String
    -date : Date
    -state : OrderState

    +toString() : String
}

class Employee extends Person{
+ addRole(role: Role): void
+ hasRole(role: Role): boolean
}

class PasswordGenerator{
    PASSWORD_LENGTH : int
    NUM_CAPITAL_LETTERS : int
    NUM_DIGITS : int
    CAPITAL_LETTERS : String
    DIGITS : String
    LOWERCASE_LETTERS : String
    random : SecureRandom
    +generatePassword() : String
    +randomCharacter(String characters) : char
    +shuffleString(String input) : String
}

class Photo{
-URI : String
-name : String
+Photo(String URI, String fileName)

}

class User{
    +getId() : Email
}

enum TypeOfProperty{
    APARTMENT
    HOUSE
    LAND
}

enum TransactionType{
    RENT
    SALE
    BUY
}

enum SunExposure{
    NORTH
    SOUTH
    EAST
    WEST
    +toString() : String
}

class AgencyRepository{
-agencies : ArrayList<Agency>
+add(Agency agency) : Optional<Agency>
+getAgencies() : ArrayList<Agency>
+getAgencyById(int id) : Agency
}

class AuthenticationRepository{
-authenticationFacade : AuthFacade
+doLogin(String email, String pwd) : boolean
+doLogout() : void
+getCurrentUserSession() : UserSession
+addUserRole(String id, String description) : boolean
+addUserWithRole(String name, String email, String pwd, String roleId) : boolean
}

class EmployeeRepository {
- employeeList: ArrayList<Employee>
+ addEmployee(employee: Employee): boolean
+getEmployeeByEmail(agentEmail)
}

class RoleRepository{
-roles : List<Role>
+getRolesToCreate(): List<Role>
+getRoleByValue(int value): Role
}

enum Role {
ADMIN
AGENT
STORE_NETWORK_MANAGER
STORE_MANAGER
CLIENT
}

class AuthenticationUI{
-ctrl : AuthenticationController
+AuthenticationUI() : AuthenticationUI
+run() : void
+doLogin() : void
+logout() : void
+redirectToRoleUI(List<MenuItem> rolesUI, UserRoleDTO role) : void
+selectsRole(List<UserRoleDTO> roles) : UserRoleDTO
}

class AdminUI{
+AdminUI() : AdminUI
+run() : void
}

class ClientUI{
+ClientUI() : ClientUI
+run() : void
}

class EmployeeUI{
+EmployeeUI() : EmployeeUI
+run() : void
}

class MainMenuUI{
-controller : AuthenticationController
+MainMenuUI() : MainMenuUI
+run() : void
}

class MenuItem{
-description : String
-ui : Runnable
+MenuItem(String description, Runnable ui) : MenuItem
+run() : void
+hasDescription(String description) : boolean
+toString() : String
}

class CreateRequestUI{
-controller : CreateRequestController
-sc : Scanner
+run() : void
+getAgentByEmail(String agentEmail) : Employee
+AgencyOptions() : void
+TransactionTypeOptions() : void
+checkTransactionType(int option) : TransactionType
+TypeOfPropertyOptions() : void
+checkTypeOfProperty(int option) : TypeOfProperty
+SunExposureOption(int option) : SunExposure
+TypeOfSunExposureOptions() : void
+validatePassportNumber(String numeroPassaporte) : boolean
+listAgents(int id) : int
+validationYN(String option) : boolean
+validatePositiveIntegerInput(String message) : int
+validatePositiveDoubleInput(String message) : double
+validateNotEmpty(String prompt) : String
}

class DevTeamUI{
+DevTeamUI() : DevTeamUI
+run() : void
}

class PublishAnnouncementUI{
-controller : PublishAnnouncementController
+PublishAnnouncementUI() : PublishAnnouncementUI
+run() : void
}

class RegisterEmployeeUI{
- controller: RegisterEmployeeController
+ run()
}

enum OrderState{
    PENDING
    ACCEPTED
    REJECTED
    +toString() : String
}

class ImportController{
-announcementRepository : AnnouncementRepository
+ImportController()
+getAnnouncementRepository() : Repository
+selectFile()
+importData(location) : importResult
}

class ImportUI{
-controller: ImportController
+ImportUI() : ImportUI
+run() : void
}

class CSVImport{
    -announcementRepository : AnnouncementRepository
    +importData()
}

class ClientRepository {
    +getClientByEmail(clientEmail)
}

class VisitSchedule {
    - propertyID : int
    - visitDate : LocalDate
    - startTime : LocalTime
    - endTime : LocalTime
    - approvedByAgent : boolean
    - agentEmail : String
    - adressOfProperty : String
    - requesterEmail : String
}

class VisitScheduleRequestsWindow {
    +listPendingVisits()
    +showFilteredVisits()
    +onbtFilterSchedules()
    +onBtReturn()
    +getMainStage()
}

class VisitScheduleRepository {
    +getVisitSchedulesByUserEmailAndDate()
    +getVisitSchedulesByAgentAndPeriod()
    +addVisitSchedule()
    +sortVisitSchedules()
    +removeVisitScheduleById()
}

class VisitScheduleUI {
    +askToScheduleVisit()
    +requestData(visitDate, startTime, endTime)
    +showConfirmationMessage()
}

class VisitScheduleController {
    - visitScheduleRepository : VisitScheduleRepository
    - announcementRepository : AnnouncementRepository
    - clientRepository : ClientRepository
    - authController : AuthenticationController
    - employeeRepository : EmployeeRepository
    - emailSender : EmailSender
    +getPendingVisitsByAgentEmail()
    +getFilteredVisitsByAgentEmail()
    +getSortVisitScheduleFromConfig()
    +getCurrentUserName()
    +selectAnnouncement(announcementID)
    +isOverlappingWithExistingSchedules(clientEmail, visitDate, startTime, endTime)
    +saveVisitSchedule(announcementID, clientEmail, visitDate, startTime, endTime, false)
    +getAllAnnouncementsSortedByDefaultCriteria()
    +approveVisit()
    +disapproveVisit()
    +removeVisit()
    +respondToBookingRequestByEmail()
}

interface SortVisitSchedule {
    +sort()
}

class BubbleSortVisitSchedule implements SortVisitSchedule {
    +sort()
}

class QuickSortVisitSchedule implements SortVisitSchedule {
    +sort()
}

class Utils {
    +sendEmail()
}

class EmailSender {
    +respondToBookingRequestEmail()
}

class StatisticsController{
      -dealRepository : AnnouncementRepository
      +getStats() : StatisticsDTO
}

class StatisticsDTO{
}

class StoreManagerMenuWindow{
    -saleForecastScene : Scene
    -bt : Button
    +onBtAction() : void
}

class Statistics{
    - isMultipleRegression : boolean
        - deals : ArrayList<Announcement>
        - forecastedPrices : ArrayList<Double>
        - intercept : double
        - interceptPValue : double
        - slope : double
        - slopePValue : double
        - correlationCoefficient : double
        - determinationCoefficient : double
        - adjustedDeterminationCoefficient : double
        - slopeStandardError : double
        - interceptStandardError : double
        - alfa : double
        - n : int
        - confidenceLevel : double
        - confidenceIntervals : double[][]
        - rejects : boolean[]
        - totalSumOfSquares : double
        - residualSumOfSquares : double
        - regressionSumOfSquares : double
        - totalDegreesOfFreedom : int
        - regressionMeanSquare : double
        - residualMeanSquare : double
        - regressionDegreesOfFreedom : int
        - residualDegreesOfFreedom : int
        - fValue : double
        - pValue : double
        - criticalValue : double
        - isSignificant : boolean
        - interceptTValue : double
        - slopeTValue : double
        - coefficientLowerBounds : double[]
        - coefficientUpperBounds : double[]
        - predictionLowerBound : double
        - predictionUpperBound : double
        - standardErrors : double[]
        - tValues : double[]
        - pValues : double[]
        - meanSquareRegression : double
        - meanSquareResidual : double
        - interceptCriticalValue : double
        - slopeCriticalValue : double
        - explainedSumOfSquares : double
        - degreesOfFreedomRSS : double
        - degreesOfFreedomTSS : double
        - meanSquaredError : double
        - multipleCriticalValue : double
        - covarianceMatrix : double[][]
        - estimatedCoefficient : double[]
        - predictionsLowerBound : ArrayList<Double>
        - predictionsUpperBound : ArrayList<Double>
        - standardError : double
        - testStatistics : double[]
        - multipleTestCriticalValue : double
        - simplePredictionIntervals : double[][]

        +calcSimpleRegressionArea() : void
        +calcSimpleRegressionBathrooms() : void
        +calcSimpleRegressionBedrooms() : void
        +calcSimpleRegressionDistance() : void
        +calcSimpleRegressionParking() : void
        +calcMultipleRegression() : void
}

class AnalyseDealsWindow{
        -controller : ImportController
        -selectRegressionModelScene : Scene
        -btImport : Button
        -btDeals : Button
        +onBtImport() : void
        +onBtDeals() : void
}

class SelectRegressionModelWindow{
    -controller : StatisticsController
    -showStatisticsScene : Scene
    -btSimpleArea : Button
    -btSimpleBathrooms : Button
    -btSimpleBedrooms : Button
    -btSimpleDistance : Button
    -btSimpleParking : Button
    -btMultiple : Button
    -btConfidence : Button
    +onBtSimpleArea() : void
    +onBtSimpleBathrooms() : void
    +onBtSimpleBedrooms() : void
    +onBtSimpleDistance() : void
    +onBtSimpleParking() : void
    +onBtMultiple() : void
    +onBtConfidence() : void
}

class ShowStatisticsWindow{
    -controller : StatisticsController
    -btPrices : Button
    -btR : Button
    -btTest : Button
    -btInterval : Button
    -btAnova : Button
    -btValues
    +onBtPrices() : void
    +onBtR() : void
    +onBtTest() : void
    +onBtInterval() : void
    +onBtAnova() : void
    +onBtValues() : void

}


Repositories -> Repositories : instances
ListAnnouncementsController ..> Repositories
ListAnouncementsUI .> ListAnnouncementsController
AuthenticationUI .> AuthenticationController
CreateRequestUI .> CreateRequestController
PublishAnnouncementUI .> PublishAnnouncementController
RegisterEmployeeUI .> RegisterEmployeeController
Repositories "1" --> "1" AnnouncementRepository : has
Repositories "1" --> "1" AgencyRepository : has
Repositories "1" --> "1" AuthenticationRepository : has
Repositories "1" --> "1" EmployeeRepository : has
Repositories "1" --> "1" RoleRepository : has
ListAnnouncementsController ..> AnnouncementRepository
CreateRequestController ..> AnnouncementRepository
CreateRequestController ..> AgencyRepository
CreateRequestController ..> EmployeeRepository
PropertyOrderManagementController ..> AnnouncementRepository
PropertyOrderManagement .> PropertyOrderManagementController
PropertyOrderManagementController ..> Repositories
PublishAnnouncementController ..> AnnouncementRepository
RegisterEmployeeController ..> EmployeeRepository
RegisterEmployeeController ..> RoleRepository
RegisterEmployeeController ..> PasswordGenerator
RegisterEmployeeController ..> AuthenticationRepository
AuthenticationController ..> AuthenticationRepository
EmployeeRepository "1" --> "*" Employee : has
AgencyRepository "1" --> "*" Agency : has
RoleRepository "1" --> "*" Role : has
Announcement "1" --> "1" Property : has
Announcement "1" --> "*" Photo : has
Announcement "1" --> "1" Commission : has
Announcement "1" --> "1" TransactionType : has
Announcement "1" --> "1" TypeOfProperty : has
House "1" --> "1" SunExposure : has
AnnouncementRepository "1" --> "*" Announcement : has
Property "1" --> "1" Address : has
MainMenuUI "1" --> "*" MenuItem : has
MainMenuUI ..> ListAnouncementsUI
MainMenuUI ..> AuthenticationUI
MainMenuUI ..> DevTeamUI
AuthenticationUI ..> ClientUI
AuthenticationUI ..> EmployeeUI
AuthenticationUI ..> AdminUI
EmployeeUI ..> PublishAnnouncementUI
ClientUI ..> CreateRequestUI
AdminUI ..> RegisterEmployeeUI
AdminUI ..> ImportUI
CreateRequestController ..> Repositories
ImportController ..> Repositories
PublishAnnouncementController ..> Repositories
RegisterEmployeeController ..> Repositories
AuthenticationRepository "1" --> "1" AuthenticationFacade : has
AuthenticationFacade "1" --> "1" UserSession : has
UserSession "1" --> "1" User : has
OrderRepository "1" --> "*" Order : has
CreateOrderController ..> AnnouncementRepository
Repositories "1" --> "1" OrderRepository : has
CreateOrderUI .> CreateOrderController
CreateOrderController ..> Repositories
Order "1" --> "1" OrderState : has
VisitSchedule <-- VisitScheduleRepository
VisitScheduleRepository <-- Repositories
VisitScheduleUI ..> VisitScheduleController
Repositories <-- VisitScheduleController
VisitScheduleUI ..> AuthenticationController
VisitScheduleRequestsWindow --> VisitScheduleController
VisitScheduleController --> EmailSender
EmailSender --> Utils
SortVisitSchedule <.. VisitScheduleRepository
StoreManagerMenuWindow ..> AnalyseDealsWindow

AnalyseDealsWindow ..> SelectRegressionModelWindow

SelectRegressionModelWindow ..> ShowStatisticsWindow
SelectRegressionModelWindow ..> StatisticsController
AnalyseDealsWindow ..> ImportController

ImportController ..> CSVImport
ImportController ..> Repositories
StatisticsController ..> Statistics

ShowStatisticsWindow ..> StatisticsController
StatisticsDTO ..> Statistics
StatisticsDTO ..> StatisticsController
Repositories --> Repositories : instances



@enduml